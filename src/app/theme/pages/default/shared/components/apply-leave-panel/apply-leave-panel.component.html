<form class="m-form m-form--fit m-form--label-align-right" (ngSubmit)="onLeaveAppSubmit(fleaveapplication)"
    id="fleaveapplication" #fleaveapplication="ngForm">
    <div class="form-body">
        <div class="row" *ngIf="userType == 'hr'">
            <div class="col-md-6  adn-form__group">
                <div class="m-form__group form-group">
                    <span class="required" aria-required="true"> * </span>
                    <label for="form_control_1">Employee</label>
                    <ng-select #allemployee="ngModel" id="allemployee" class="m-input m-input--air" name="allemployee"
                        [items]="employeesData" bindLabel="ddLabel" bindValue="_id" placeholder="Select Employee"
                        [(ngModel)]="leaveapplication.emp_id" (ngModelChange)="onChangedEmployee()" [clearable]="false"
                        required>
                        <ng-template ng-label-tmp let-item="item" let-index="index">
                            {{item.fullName}} {{item.userName ? ('[' + item.userName
                                        +']'):''}}
                        </ng-template>
                        <ng-template ng-option-tmp let-item="item" let-index="index" disabled>
                            {{item.fullName}} {{item.userName ? ('[' + item.userName
                                        +']'):''}}
                        </ng-template>
                    </ng-select>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && !allemployee.valid">
                        This field is required.
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 adn-form__group">
                <div class="m-form__group form-group">
                    <label for="form_control_1">Leave Type</label>
                    <span class="required" aria-required="true"> * </span>
                    <ng-select #ddLeaveType class="m-input m-input--air" name="leaveType" bindValue="_id"
                        bindLabel="type" [items]="leaveTypesDetails" [(ngModel)]="leaveapplication.leaveType"
                        id="leavetype" #leavetype="ngModel" placeholder="Select Leave Type"
                        (ngModelChange)="onChangeLeaveType($event,leaveapplication,true)" [clearable]="false" required>
                    </ng-select>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && !leavetype.valid">
                        This field is required.
                    </div>
                </div>
            </div>
            <div class="col-md-3 adn-form__group">
                <div class="m-form__group form-group">
                    <label for="form_control_1">From Date</label>
                    <span class="required" aria-required="true">* </span>
                    <input type="text" class="form-control m-input m-input--air" name="fromDate"
                        (ngModelChange)="calculateDays($event, 'fromDate', leaveapplication)"
                        placeholder="Select From Date" [(ngModel)]="leaveapplication.fromDate" #fromDate="ngModel"
                        bsDatepicker [readonly]="true" [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
                        [minDate]="leaveapplication.fYear?.startDate" [maxDate]="leaveapplication.fYear?.endDate"
                        id="fromDate" required>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && leavetype.valid">
                        <span *ngIf="fleaveapplication.submitted && !fromDate.valid">This
                            field is required.</span>
                        <span
                            *ngIf="fleaveapplication.submitted && !fromDateValidation.isValid">{{fromDateValidation.msg}}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 adn-form__group">
                <div class="m-form__group form-group">
                    <label for="form_control_1">To Date</label>
                    <span class="required" aria-required="true">* </span>
                    <input type="text" class="form-control m-input m-input--air" name="toDate"
                        (ngModelChange)="calculateDays($event, 'toDate', leaveapplication)" placeholder="Select To Date"
                        bsDatepicker [readonly]="true" [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }" id="toDate"
                        [(ngModel)]="leaveapplication.toDate" [minDate]="leaveapplication.fromDate"
                        [maxDate]="leaveapplication.fYear?.endDate" #toDate="ngModel" required>
                    <div class="form-control-feedback has-danger" *ngIf="!toDate.valid && leavetype.valid">
                        <span *ngIf="fleaveapplication.submitted && !toDate.valid">This
                            field is required.</span>

                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 adn-form__group">
                <div class="m-form__group form-group">
                    <label for="form_control_1">Days</label>
                    <span class="pl1r">{{leaveapplication.days}}</span>
                    <span class="pl1r">
                        <button class="btn btn-success" type="button"
                            (click)="processSandwich(leaveapplication)">Calculate
                            Days</button>
                    </span>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && leavetype.valid">
                        <span *ngIf="!leaveapplication.areDaysValid">Please Calculate
                            Days</span>
                    </div>
                    <div class="form-control-feedback has-danger" *ngIf="!leaveapplication.isSandwichValid">
                        <span *ngIf="!leaveapplication.areDaysValid">{{leaveapplication.daysValidationMsg}}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-6 adn-form__group">
                <div class="m-form__group form-group">
                    <label for="form_control_1">Balance</label>
                    <span class="pl1r">{{leaveapplication.balance}}</span>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && leavetype.valid">
                        <span *ngIf="!leaveapplication.isBalanceValid">
                            Not enough balance
                        </span>
                    </div>
                    <div *ngIf="leaveapplication.leaveType == 4" class="specialBalance">
                        <span>Paid: {{specialLeaveBalance.paid}}</span>
                        <span>UnPaid: {{specialLeaveBalance.unpaid}}</span>

                    </div>
                    <div *ngIf="leaveapplication.leaveType == 4 || leaveapplication.leaveType == 3" class="hrRemarks">
                        <label for="form_control_1">Hr Remarks</label>
                        <textarea name="hrRemarks" class="form-control m-input m-input--air" rows="3"
                            [(ngModel)]="specialLeaveBalance.remarks" disabled></textarea>
                    </div>


                </div>
            </div>
        </div>
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- Additional Leaves Start -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <div class="additionalLeaves" *ngFor="let additionalLeave of additionalLeaves;let i = index;">
            <div class="row">
                <div class="col-md-6 adn-form__group">
                    <div class="m-form__group form-group">
                        <label for="form_control_1">Leave Type</label>
                        <span class="required" aria-required="true"> * </span>
                        <ng-select #ddLeaveType class="m-input m-input--air" name="leaveType_{{i}}" bindValue="_id"
                            bindLabel="type" [items]="leaveTypesDetails" [(ngModel)]="additionalLeave.leaveType"
                            #additionalleavetype_i="ngModel" placeholder="Select Leave Type"
                            (ngModelChange)="onChangeLeaveType($event, additionalLeave)" [clearable]="false" required>
                        </ng-select>
                        <div class="form-control-feedback has-danger"
                            *ngIf="fleaveapplication.submitted && !additionalleavetype_i.valid">
                            This field is required.
                        </div>
                    </div>
                </div>
                <div class="col-md-3 adn-form__group">
                    <div class="m-form__group form-group">
                        <label for="form_control_1">From Date</label>
                        <span class="required" aria-required="true">* </span>
                        <input type="text" class="form-control m-input m-input--air" name="fromDate_{{i}}"
                            (ngModelChange)="calculateDays($event, 'fromDate', additionalLeave)"
                            placeholder="Select From Date" [(ngModel)]="additionalLeave.fromDate" #fromDate_i="ngModel"
                            bsDatepicker [readonly]="true" [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
                            [minDate]="leaveapplication.fYear?.startDate" id="fromDate_{{i}}" required>
                        <div class="form-control-feedback has-danger"
                            *ngIf="fleaveapplication.submitted && additionalleavetype_i.valid">
                            <span *ngIf="fleaveapplication.submitted && !fromDate_i.valid">This
                                field is required.</span>
                            <span
                                *ngIf="fleaveapplication.submitted && !fromDateValidation.isValid">{{fromDateValidation.msg}}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 adn-form__group">
                    <div class="m-form__group form-group">
                        <label for="form_control_1">To Date</label>
                        <span class="required" aria-required="true">* </span>
                        <input type="text" class="form-control m-input m-input--air" name="toDate_{{i}}"
                            (ngModelChange)="calculateDays($event, 'toDate', additionalLeave)"
                            placeholder="Select To Date" [(ngModel)]="additionalLeave.toDate" #toDate_i="ngModel"
                            bsDatepicker [readonly]="true" [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
                            [minDate]="additionalLeave.fromDate" [maxDate]="leaveapplication.fYear?.endDate"
                            id="toDate_{{i}}" required>
                        <div class="form-control-feedback has-danger"
                            *ngIf="!toDate_i.valid && additionalleavetype_i.valid">
                            <span *ngIf="fleaveapplication.submitted && !toDate_i.valid">This
                                field is required.</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 adn-form__group">
                    <div class="m-form__group form-group">
                        <label for="form_control_1">Days</label>
                        <span class="pl1r">{{additionalLeave.days}}</span>
                        <span class="pl1r">
                            <button class="btn btn-success" type="button"
                                (click)="processSandwich(additionalLeave)">Calculate
                                Days</button>
                        </span>
                        <div class="form-control-feedback has-danger"
                            *ngIf="fleaveapplication.submitted && additionalleavetype_i.valid">
                            <span *ngIf="!additionalLeave.areDaysValid">
                                Please Calculate Days
                            </span>
                        </div>
                        <div class="form-control-feedback has-danger" *ngIf="!additionalLeave.isSandwichValid">
                            <span *ngIf="!additionalLeave.areDaysValid">{{additionalLeave.daysValidationMsg}}</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 adn-form__group">
                    <div class="m-form__group form-group">
                        <label for="form_control_1">Balance</label>
                        <span class="pl1r">{{additionalLeave.balance}}</span>
                        <div class="form-control-feedback has-danger"
                            *ngIf="fleaveapplication.submitted && additionalleavetype_i.valid">
                            <span *ngIf="!additionalLeave.isBalanceValid">
                                Not enough balance
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" *ngIf="leaveapplication.leaveType == 3 || leaveapplication.leaveType == 4">
            <div class="col-md-6 adn-form__group">
            </div>
            <div class="col-md-6 adn-form__group">
                <div class="m-form__group form-group">
                    <button class="btn btn-success submitForm pull-right" type="button" (click)="addMore()">Add
                        More</button>
                </div>
            </div>
        </div>
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- Additional Leaves End -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <div class="row">
            <div class="col-md-6 adn-form__group">
                <div class="form-group m-form__group">
                    <label for="form_control_1">Approving Authority</label>
                    <span class="pl1r">{{primarySupervisor?.fullName}}</span>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && leavetype.valid">
                        <span *ngIf="!supervisorPresent">Supervisor Required</span>
                    </div>
                </div>
            </div>
            <div class="col-md-6 adn-form__group">
                <div class="m-form__group form-group">
                    <label for="form_control_1">Reason</label>
                    <span class="required" aria-required="true"> * </span>
                    <textarea name="reason" id="reason" class="form-control m-input m-input--air" rows="3"
                        placeholder="Reason" [(ngModel)]="leaveapplication.reason" #reason="ngModel"
                        required></textarea>
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && !reason.valid && leavetype.valid">
                        This field is required.
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 adn-form__group">
                <div class="m-form__group form-group attachment">
                    <label for="form_control_1">Attachment (max. size 300kb)</label>
                    <span class="required" aria-required="true" *ngIf="isAttachmentAdded"> *
                    </span>
                    <span class="fileName" *ngIf="leaveapplication.attachmentName">{{leaveapplication?.attachmentName}}
                        <i class="fa fa-times" (click)="clearAttachment()"></i>
                    </span>
                    <label class="btn btn-default browse">
                        Browse
                        <input type="file" accept="application/pdf" hidden="hidden" name="attachement" #documentsPdf
                            ngFileSelect [options]="options"
                            (uploadOutput)="onUploadOutput($event, document.documentName)" [uploadInput]="uploadInput"
                            (click)="documentsPdf.click()">
                        <!-- <input type="file" name="attachment" (change)="onFilePick($event)" value="Upload Document" /> -->
                    </label>
                    <!-- <span>max size 300kb</span> -->
                    <div class="form-control-feedback has-danger"
                        *ngIf="fleaveapplication.submitted && leavetype.valid">
                        <span *ngIf="isAttachmentAdded">This field is required.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-actions">
        <div class="row">
            <div class="col-md-12">
                <div class="m-form__actions">
                    <button class="btn btn-success submitForm" type="submit" id="submitForm">Apply</button>
                    <button class="btn btn-secondary" (click)="fleaveapplication.resetForm();InitValues();"
                        type="button">Clear</button>
                    <button class="btn btn-secondary" (click)="goToDashboard();" type="button">Go Back</button>
                </div>
            </div>
        </div>
    </div>
</form>